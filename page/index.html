<!DOCTYPE html>
<html class="dark">

<head>
  <meta charset="utf-8">
  <title>sEMTor – The EMT simulator</title>
  <meta name="description" content="Interactive EMT simulator 
  acompaning the article: 
  Modelling variability and heterogeneity of EMT scenarios highlights nuclear positioning 
  and protrusions as main drivers of extrusion by 
  Steffen Plunder, Cathy Danesin, Bruno Glise, Marina A Ferreira, Sara Merino Aceituno and Eric Theveneau.
  ">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/main.css">
</head>

<body class="bg-slate-200 dark:bg-slate-900 text-slate-900 dark:text-slate-100">
  <div class="mx-auto p-4 bg-white dark:bg-slate-900">


    <div class="container mx-auto max-w-2xl">
      <p class="text-4xl font-semibold mb-4 mt-4 md:mb-8">
        <span
          class="bg-clip-text text-transparent bg-gradient-to-r from-green-500 to-red-500 dark:from-green-400 dark:to-red-400">
          sEMTor – The EMT simulator
        </span>
      </p>

      <p class="dark:text-slate-400" text>
        <span class="italic text-sm">
          Developed by Steffen Plunder, see the companion article:
        </span>
        <br><br>
        <span class="dark:text-slate-200 font-semibold">
          Modelling variability and heterogeneity of EMT scenarios highlights nuclear positioning and protrusions as
          main drivers of extrusion
        </span>
        <br>
        <span class="italic">
          Steffen Plunder, Cathy Danesin, Bruno Glise, Marina A Ferreira, Sara Merino Aceituno and Eric Theveneau, 2023,
        </span> <a href="https://www.biorxiv.org/content/10.1101/2023.11.17.567510v1" class="underline">bioRxiv</a>.
      </p>
      <br>

      An interactive, agent-based model to simulate epithelial-to-mesenchymal transitions-like events in a
      pseudostratified epithelium. <br>
      &emsp;The simulation has epithelial <span class="text-green-500 dark:text-green-400">control cells (green)</span>
      and <span class="text-red-500 dark:text-red-400">experimental cells (red)</span>.
      Experimental cells can be instructed to perform some or all of the following events in various orders:
      <ul class="list-item list-inside pl-4">
        <li>
          <span class="font-bold italic">→ A</span>&ensp; Loss of apical adhesion (detachment from neighboring apical
          points).
        </li>
        <li>
          <span class="font-bold italic">→ B</span>&ensp; Loss of basal adhesion (detachment from basal line).
        </li>
        <li>
          <span class="font-bold italic">→ S</span>&ensp; Relaxation of straightness (apical/basal points and nuclei are
          no longer forced to align).
        </li>
        <li>
          <span class="font-bold italic">→ P</span>&ensp;
          Protrusive activities (seek-and grab behavior of basal points in direction of the polarity, typically basally,
          can only occur if B is part of the selected EMT-like scenario).
        </li>
      </ul>
      <br>

      <div class="rounded-lg ring-red-800 ring-2 p-2 mt-2 mb-8 italic">
        Note: Our scientific conclusions from the model are based on statistics obtained from thousands of simulations
        of the model shown below. Please note that in some instances, single simulations can differ substantially from
        the average behavior.
      </div>
    </div>

    <div class="grid xl:grid-cols-3 md:grid-cols-3 grid-cols-1 max-w-screen-2xl mx-auto">
      <div class="xl:col-span-2 md:col-span-2">
        <div class="m-2 mb-0 rounded-lg bg-white p-2 
        border-slate-200 border-2
        dark:border-0">
          <div id="simulation" class="text-slate-800">
            <div class="mx-auto max-w-2xlw-full relative">
              <p>
                <span class="font-semibold italic">Simulation</span>
                <span class="text-red-800 float-right text-xs font-thin">Apical side (red)
                </span>
                <span
                  class="absolute left-4 top-10 font-bold text-red-800 text-xs md:text-xl bg-red-100 rounded-lg p-2 bg-opacity-50"
                  id="sim_end" style="display: none;">Simulation
                  end: Click to restart simulation.</span>
              </p>
              <div id="sim_div" class="bg-slate-50 aspect-w-16 aspect-h-9"></div>
              <div>
                <p class="text-slate-800 float-right text-xs font-thin">Basal side (black)</p>
                <p id="time" class="text-xs font-bold mx-4 font-mono"> Time = 10</p>
              </div>

              <div class="mx-4 relative text-slate-400 text-xs md:text-base">
                <span class=""> 0h </span>
                <span class="left-1/4 absolute text-center"> 12h </span>
                <span class="left-1/2 absolute text-center"> 24h </span>
                <span class="left-3/4 absolute text-center"> 36h </span>
                <span class="right-0 absolute"> 48h </span>
              </div>
              <div class="bg-slate-400 h-1 mx-4">
                <div id="progress_bar" class="bg-slate-800 h-1 mr-auto" style="width:1%"></div>
                <div class="relative text-xs md:text-base font-bold">
                  <span style="left: 10%;" class="absolute text-orange-600" id="A_time">A</span>
                  <span style="left: 20%;" class="absolute text-black" id="B_time">B</span>
                  <span style="left: 50%;" class="absolute text-blue-600" id="S_time">S</span>
                </div>
              </div>
            </div>
            <div class="w-full h-2">
            </div>

            <div class="flex flex-wrap mt-4 justify-center">
              <div class="pl-2 mb-2 mt-2">
                <button id="run_button"
                  class="bg-green-800 hover:bg-green-600 text-white font-medium p-2 rounded-lg text-sm text-center inline-flex items-centerfont-medium">New
                  simulation</button>
              </div>
              <div class="pl-2 mb-2 mt-2">
                <button id="play_button"
                  class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium p-2 rounded-lg text-sm text-center inline-flex items-centerfont-medium">Play/Pause</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="rounded-b-lg m-2 mt-0 p-2 ring-slate-200 dark:ring-slate-800 ring-2 ring-inset">
        <div id="parameters" class="container mx-auto">
          <h2 class="mt-2 text-center font-medium italic">Parameters</h2>
          <h4 class="mb-2 mt-1 text-center font-extralight text-xs text-slate-600 dark:text-slate-400">
            (Restart required)</h4>

          <div class="grid sm:grid-cols-2 md:grid-cols-1 xl:grid-cols-1 gap-4">
            <div class=" dark:bg-slate-800 rounded-lg border-t-2 border-slate-200 dark:border-slate-500">
              <div class="container text-sm pt-2 w-full">
                <div class="p-1 my-2 text-center">
                  <p class="pl-2 font-semibold">Number of experimental cells
                  </p>
                  <div id="N_homo">
                    <input id="N_input" type="range" value="2" min="0" max="2"
                      class="w-3/4 mx-auto mt-2 h-2 bg-slate-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                    <div class="relative w-3/4 mx-auto text-xs mb-4">
                      <span class="absolute left-0">0</span>
                      <span class="absolute left-1/2">1</span>
                      <span class="absolute right-0">11</span>
                    </div>
                    <div class="font-extralight text-xs pt-2">
                      Number of cells undergoing EMT-like events.
                    </div>
                  </div>
                  <div id="N_hetero" style="display: none;">
                    <div class="mt-2">
                      10 (heterogeneous) EMT cells
                    </div>
                    <div class="font-extralight text-xs pt-2">
                      Number of cells undergoing EMT. Disable heterogeneity to
                      enable the selection of zero or one EMT cells.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class=" dark:bg-slate-800 rounded-lg border-t-2 border-slate-200 dark:border-slate-500">
              <div class="container text-sm pt-2 w-full">
                <div class="p-1 my-2 text-center">
                  <div id="INM_hetero" style="display: none;">
                    <p class="pl-2 font-semibold">Interkinetic nuclear movements
                    </p>
                    <input id="INM_input_hetero" type="range" value="" min="0" max="2"
                      class="w-3/4 mx-auto mt-2 h-2 bg-slate-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                    <div class="relative w-3/4 mx-auto text-xs mb-4">
                      <span class="absolute left-0">none</span>
                      <span class="absolute right-0">100%</span>
                    </div>
                    <div class="font-extralight text-xs">
                      Determines probability that nuclei of experimental cells perform pre-mitosis rapid apical movement
                      (PRAM).
                    </div>
                  </div>
                  <div id="INM_homo">
                    <p class="pl-2 font-semibold">Interkinetic nuclear movements
                    </p>
                    <label class="relative inline-flex items-center cursor-pointer mt-2">
                      <input type="checkbox" name="Hetero" id="INM_input_homo" class="sr-only peer">
                      <div
                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600">
                      </div>
                    </label>
                    <div class="font-extralight text-xs">
                      Determines if nuclei of experimental cells perform pre-mitosis rapid apical movement (PRAM).
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class=" dark:bg-slate-800 rounded-lg border-t-2 border-slate-200 dark:border-slate-500">
              <div class="container text-sm pt-2 w-full">
                <div class="p-1 my-2 text-center">
                  <div id="run_hetero" style="display: none;">
                    <p class="pl-2 font-semibold">EMT: Protrusions
                    </p>
                    <input id="run_input_hetero" type="range" value="2" min="0" max="2"
                      class="w-3/4 mx-auto mt-2 h-2 bg-slate-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                    <div class="relative w-3/4 mx-auto text-xs mb-4">
                      <span class="absolute left-0">none</span>
                      <span class="absolute right-0">100%</span>
                    </div>
                    <div class="font-extralight text-xs">
                      Determines probability that the basal point of experimental cells display a seek-and-grab behavior
                      (<span class="font-bold italic">P</span>).
                      This can only occur if the EMT scenario includes <span class="font-bold italic">B</span> (loss of
                      basal adhesion).
                    </div>
                  </div>
                  <div id="run_homo">
                    <p class="pl-2 font-semibold">EMT: Protrusions
                    </p>
                    <label class="relative inline-flex items-center cursor-pointer mt-2">
                      <input type="checkbox" name="Hetero" id="run_input_homo" class="sr-only peer">
                      <div
                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600">
                      </div>
                    </label>
                    <div class="font-extralight text-xs">
                      Determines if the basal point of experimental cells display a seek-and-grab behavior (<span
                        class="font-bold italic">P</span>).
                      This can only occur if the EMT scenario includes <span class="font-bold italic">B</span> (loss of
                      basal adhesion).
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div class="dark:bg-slate-800 rounded-lg  border-t-2 border-slate-200 dark:border-slate-500">
              <div class="container text-sm pt-2">
                <div class="p-1 my-2">
                  <div class="w-full text-center">
                    <div class="">
                      <div class="pl-2 font-semibold pb-2">Heterogeneity
                      </div>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="Hetero" id="hetero_input" class="sr-only peer">
                        <div
                          class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600">
                        </div>
                      </label>
                    </div>
                    <div class="font-extralight text-xs">
                      If checked, each experimental cell randomly picks an EMT-like scenario.
                      Then users can set the probability of INM and Protrusions to 0, 50 or 100%.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="dark:bg-slate-800 rounded-lg  border-t-2 border-slate-200 dark:border-slate-500">
              <div class="container text-sm pt-2">
                <div class="p-1 my-2">
                  <div class="flex flex-wrap justify-center text-center">
                    <div id="scenario_div_homo">
                      <div>
                        <!--
                                                  class="text-white bg-slate-800 hover:bg-slate-600 focus:ring-4 focus:outline-none focus:ring-slate-800 font-medium rounded-lg text-sm text-center inline-flex items-center">
                                                -->
                        <label data-te-select-init-ref class="pl-2 font-semibold">
                          EMT-like scenarios
                        </label>
                        <select data-te-select-init id="EMT_scenario">
                          <!--<option value="[0,0,0]">no EMT  </option>-->
                          <option value="[12,0,0]">A</option>
                          <option value="[0,12,0]">B</option>
                          <option value="[0,0,12]">S</option>
                          <option value="[9,15,0]">AB</option>
                          <option value="[15,9,0]">BA</option>
                          <option value="[9,0,15]">AS</option>
                          <option value="[15,0,9]">SA</option>
                          <option value="[0,9,15]">BS</option>
                          <option value="[0,15,9]">SB</option>
                          <option value="[9,15,21]" selected>ABS</option>
                          <option value="[9,21,15]">ASB</option>
                          <option value="[15,9,21]">BAS</option>
                          <option value="[21,9,15]">BSA</option>
                          <option value="[15,21,9]">SAB</option>
                          <option value="[21,15,9]">SBA</option>
                        </select>
                      </div>
                      <div class="font-extralight text-xs pt-2">
                        Determines which EMT-like scenario experimental cells will perform.
                      </div>
                    </div>
                    <div id="scenario_div_hetero" style="display: none;">
                      <div class="pl-2 font-semibold">
                        EMT scenario
                      </div>
                      <div class="mt-2">
                        Random EMT scenario per cell
                      </div>
                      <div class="font-extralight text-xs pt-2">
                        For heterogeneous EMT, each cell selects randomly if A, B, S are occuring.
                        Disable heterogeneity to select a specific EMT scenario.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mx-auto max-w-xl">

    <div class="rounded-b-lg m-2 mt-0 p-2 ">

      <h2 class="mt-2 text-center font-medium italic">EMT scenarios per cell</h2>

      <div class="flex flex-col">
        <div class="overflow-x-auto sm:-mx-6 lg:-mx-8">
          <div class="inline-block min-w-full py-2 sm:px-6 lg:px-8">
            <div class="overflow-hidden">
              <table class="min-w-full text-center text-sm font-light">
                <thead class="border-b font-medium dark:border-neutral-500">
                  <tr>
                    <th scope="col" class="px-6 py-2">#</th>
                    <th scope="col" class="px-6 py-2">A</th>
                    <th scope="col" class="px-6 py-2">B</th>
                    <th scope="col" class="px-6 py-2">S</th>
                    <th scope="col" class="px-6 py-2">INM</th>
                    <th scope="col" class="px-6 py-2">Protrusions</th>
                  </tr>
                </thead>
                <tbody id="timing_table">
                  <tr class="border-b dark:border-neutral-500 text-sm">
                    <td class="px-6 py-2 font-medium">1</td>
                    <td class="px-6 py-2">10h</td>
                    <td class="px-6 py-2">18h</td>
                    <td class="px-6 py-2">none</td>
                    <td class="px-6 py-2">Yes</td>
                    <td class="px-6 py-2">Yes</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/p5.min.js"></script>
  <script type="text/javascript" src="js/tw-elements.umd.min.js"></script>

  <script src="simulation.js"></script>
  <script>

    var $ = function (id) { return document.getElementById(id); };

    // function init_params(pcontrol, params) {
    //   if(pcontrol.hetero) {
    //           // copy values from pcontrol into the emt cell type
    //           params.general.N_emt = 10;
    //           params.general.N_init = params.general.N_emt + 35;
    //           const emt = params.cell_types.emt;
    //           emt.events.time_A.min = 6.0;
    //           emt.events.time_B.min = 6.0;
    //           emt.events.time_S.min = 6.0;

    //           emt.events.time_P.min = pcontrol.B;
    //           emt.events.time_P.max = pcontrol.B;

    //           emt.run = pcontrol.run;
    //           emt.INM = pcontrol.INM;

    //           // set max values for emt events time_A, time_B, time_S to the min values
    //           emt.events.time_A.max = emt.events.time_A.min + 18;
    //           emt.events.time_B.max = emt.events.time_B.min + 18;
    //           emt.events.time_S.max = emt.events.time_S.min + 18;
    //       }
    //       else 
    //       {    
    //           // copy values from pcontrol into the emt cell type
    //           params.general.N_emt = pcontrol.N;
    //           params.general.N_init = params.general.N_emt + 35;
    //           const emt = params.cell_types.emt;
    //           emt.events.time_A.min = pcontrol.A;
    //           emt.events.time_B.min = pcontrol.B;
    //           emt.events.time_S.min = pcontrol.S;

    //           emt.events.time_P.min = pcontrol.B;
    //           emt.events.time_P.max = pcontrol.B;

    //           emt.run = pcontrol.run;

    //           emt.INM = pcontrol.INM;

    //           // set max values for emt events time_A, time_B, time_S to the min values
    //           emt.events.time_A.max = emt.events.time_A.min + 6;
    //           emt.events.time_B.max = emt.events.time_B.min + 6;
    //           emt.events.time_S.max = emt.events.time_S.min + 6;
    //       }
    //     }

    const params = {
      general: {
        t_end: 48,
        dt: 0.1,
        random_seed: 0,
        init_basal_junction_dist: 0.3,
        N_init: 30,
        N_max: 70,
        N_emt: 1,
        w_init: 8,
        h_init: 10,
        mu: 0.2,
        n_substeps: 30,
        alg_dt: 0.01,
        w_screen: 25,
        h_screen: 20,
        p_div_out: 0.8,
      },
      cell_prop: {
        apical_junction_init: 0.3,
        max_basal_junction_dist: 0.6,
        basal_daming_ratio: 1.0,
        cytos_init: 1.5,
        diffusion: 0.1,

      },
      cell_types: {
        control: {
          name: 'control',
          R_hard: 0.3,
          R_hard_div: 0.7,
          R_soft: 1.0,
          color: { r: 30, g: 100, b: 20 },
          dur_G2: 0.5,
          dur_mitosis: 0.5,
          k_apical_junction: 1.0,
          k_cytos: 5.0,
          run: 0.0,
          running_speed: 1.0,
          running_mode: 0,
          stiffness_apical_apical: 5.0,
          stiffness_apical_apical_div: 10.0,
          stiffness_nuclei_apical: 2.0,
          stiffness_nuclei_basal: 2.0,
          stiffness_repulsion: 1.0,
          stiffness_straightness: 15.0,
          lifespan: { min: 10, max: 21 },
          INM: 1.0,
          hetero: false,
          events: {
            time_A: { min: Infinity, max: Infinity},
            time_B: { min: Infinity, max: Infinity},
            time_S: { min: Infinity, max: Infinity},
            time_P: { min: Infinity, max: Infinity },
          }
        },
        emt: {
          name: 'emt',
          R_hard: 0.3,
          R_hard_div: 0.7,
          R_soft: 1.0,
          color: { r: 150, g: 0, b: 0 },
          dur_G2: 0.5,
          dur_mitosis: 0.5,
          k_apical_junction: 1.0,
          k_cytos: 5.0,
          run: 0.0,
          running_speed: 1.0,
          running_mode: 0,
          stiffness_apical_apical: 5.0,
          stiffness_apical_apical_div: 10.0,
          stiffness_nuclei_apical: 2.0,
          stiffness_nuclei_basal: 2.0,
          stiffness_repulsion: 1.0,
          stiffness_straightness: 15.0,
          lifespan: { min: 10, max: 21 },
          INM: 0.0,
          hetero: false,
          events: {
            time_A: { min: 6, max: 24 },
            time_B: { min: 6, max: 24 },
            time_S: { min: 6, max: 24 },
            time_P: { min: 6, max: 24 },
          }
        }
      }
    }

    function init_params(p) {

    }

    function init_display(s) {
        const pg = params.general;
        const emt = params.cell_types.emt;  

        function update_label(t, el) {
          if( t < pg.t_end && !emt.hetero )
            el.style = "left: " + String(t / pg.t_end * 100) + "%";
        else
            el.style = "display: none;"
        } 

        update_label(emt.events.time_A.min, p_A);
        update_label(emt.events.time_B.min, p_B);
        update_label(emt.events.time_S.min, p_S);

        if( emt.run > 0 )
            p_B.innerHTML  = "B(p)"
        else
            p_B.innerHTML  = "B"

        p_sim_end.style = "display:none;"

        // update timing table: 

        let j = 0; 
        p_info.innerHTML = '';
        for(let i = 0; i < s.cells.length; ++i) {
            if( s.cells[i].type.name == 'emt' ) {
                const A = s.cells[i].time_A;
                const B = s.cells[i].time_B;
                const S = s.cells[i].time_S;
                const P = s.cells[i].time_P;
                const row_s = '<td class="px-6 py-2 font-medium">' + String(j+1) + '</td>' +
                            '<td class="px-6 py-2 font-medium">' + (A < Infinity ? A.toFixed(1)+"h" : "") + '</td>' +
                            '<td class="px-6 py-2 font-medium">' + (B < Infinity ? B.toFixed(1)+"h" : "") + '</td>' +
                            '<td class="px-6 py-2 font-medium">' + (S < Infinity ? S.toFixed(1)+"h" : "") + '</td>' +
                            '<td class="px-6 py-2 font-medium">' + (s.cells[i].has_inm ? "Yes" : "") + '</td>' +
                            '<td class="px-6 py-2 font-medium">' + (P*B < Infinity ? "Yes" : "") + '</td>';

                if( j < p_info.rows.length ) {
                    const row = p_info.rows[j];
                    row.innerHTML = row_s;
                }
                else {
                    const row = p_info.insertRow(-1);
                    row.innerHTML = row_s;
                }
                j += 1;
            }
        }

        for(let i = j; i < 11; ++i) {
            if( i < p_info.rows.length ) {
                const row = p_info.rows[i];
                row.innerHTML =  '<td class="px-6 py-2 font-medium">' + String(i+1) + '</td>';
            }
            else {
                const row = p_info.insertRow(-1);
                row.innerHTML =  '<td class="px-6 py-2 font-medium">' + String(i+1) + '</td>';
            }
        }
    }

    const p_time = $("time");
    const p_prog = $("progress_bar");
    const p_A = $("A_time");
    const p_B = $("B_time");
    const p_S = $("S_time");
    const p_sim_end = $("sim_end");
    const p_info = $("timing_table");

    function update_display(p, s) {
        const pg = params.general;
        p_time.innerHTML = "" + String(s.t.toFixed(1)) + "h"; 
        p_prog.style = "width: " + String(s.t / params.general.t_end * 100) + "%";

        if( s.cells.length == params.general.N_max) {
             p.fill(0,0,0);
             p.text("Maximal number of cells reached. Cell division inactive.", -pg.w_screen/2 + 4, 0.2*hs);
        }

        if( s.t > pg.t_end ) {
          p_sim_end.style = "display:block;"
        }
    };

    let inputs = {
      params: params,
      init_params: init_params,
      init_display: init_display,
      update_fnc: 0,
      update_display: update_display,
      ui_fnc: 0,
      screen_size: { w: 1280.0, h: 512 }
    };

    let sim_emt_p5 = new p5(p => sim_emt(p, inputs, $('sim_div')), 'sim_div');

    // pcontrol.run = false;
    // pcontrol.INM = true;
    // pcontrol.A = 9;
    // pcontrol.B = 15;
    // pcontrol.S = 21;
    // pcontrol.N = 11;

    function controlFromHtml() {

      const pg = params.general;
      const emt = params.cell_types.emt;

      let hetero = $("hetero_input").checked;

      if (hetero) {
        pg.N_emt = 11;
        pg.N_init = pg.N_emt + 35;

        emt.INM = parseFloat($("INM_input_hetero").value) / 2.0
        emt.run = parseFloat($("run_input_hetero").value) / 2.0
        emt.hetero = true;

        emt.events.time_A = {min: 6, max: 24};
        emt.events.time_B = {min: 6, max: 24};
        emt.events.time_S = {min: 6, max: 24};
        emt.events.time_P = {min: 6, max: 24};

        // timings are always the same rage: 
      }
      else {
        let N_cases = parseInt($("N_input").value);
        if (N_cases == 0) {
          pg.N_emt = 0;
        } else if (N_cases == 1) {
          pg.N_emt = 1;
        } else {
          pg.N_emt = 11;
        }
        pg.N_init = pg.N_emt + 35;

        emt.INM = $("INM_input_homo").checked ? 1.0 : 0.0;
        emt.run = $("run_input_homo").checked ? 1.0 : 0.0;

        const emt_sc = $("EMT_scenario");
        var emt_times = JSON.parse(emt_sc.options[emt_sc.selectedIndex].value);
        // replace in emt_times = 0 with Infinity
        for (let i = 0; i < emt_times.length; i++) {
          if (emt_times[i] == 0) {
            emt_times[i] = Infinity;
          }
        }

        let A = emt_times[0];
        let B = emt_times[1];
        let S = emt_times[2];
        let P = B;

        emt.events.time_A = {min: A, max: A+0.05};
        emt.events.time_B = {min: B, max: B+0.05};
        emt.events.time_S = {min: S, max: S+0.05};
        emt.events.time_B = {min: P, max: P+0.05};
      }

      sim_emt_p5.init();
    }

    controlFromHtml();

    // when run_button is pressed, call sim_emt.init()
    $("run_button").addEventListener("click", function () {
      sim_emt_p5.init();
    });

    $("play_button").addEventListener("click", function () {
      sim_emt_p5.pause();
    });


    $("hetero_input")
      .addEventListener("change", function () {
        let hetero = this.checked;
        if (hetero) {
          $("N_hetero").style.display = "block";
          $("N_homo").style.display = "none";
          $("INM_hetero").style.display = "block";
          $("INM_homo").style.display = "none";
          $("run_hetero").style.display = "block";
          $("run_homo").style.display = "none";
          $("scenario_div_hetero").style.display = "block";
          $("scenario_div_homo").style.display = "none";

          //$("INM_input_hetero").value = ($("INM_input_homo").checked ? 1.0 : 0.0 )
          //$("run_input_hetero").value = ($("run_input_homo").checked ? 1.0 : 0.0 )
        }
        else {
          $("N_hetero").style.display = "none";
          $("N_homo").style.display = "block";
          $("INM_hetero").style.display = "none";
          $("INM_homo").style.display = "block";
          $("run_hetero").style.display = "none";
          $("run_homo").style.display = "block";
          $("scenario_div_hetero").style.display = "none";
          $("scenario_div_homo").style.display = "block";

          //$("INM_input_homo").checked = (parseFloat($("INM_input_hetero").value) < 0.5 ? false : true )
          //$("run_input_homo").checked = (parseFloat($("run_input_hetero").value) < 0.5 ? false : true )
        }

        controlFromHtml();
      });

    $("N_input")
      .addEventListener("change", function () {
        controlFromHtml();
      });

    $("INM_input_hetero")
      .addEventListener("change", function () {
        controlFromHtml();
      });

    $("INM_input_homo")
      .addEventListener("change", function () {
        controlFromHtml();
      });

    $("run_input_hetero")
      .addEventListener("change", function () {
        controlFromHtml();
      });

    $("run_input_homo")
      .addEventListener("change", function () {
        controlFromHtml();
      });

    // load EMT scenario from html
    $("EMT_scenario").addEventListener("change", function () {
      controlFromHtml();
    });


  </script>
</body>

</html>